{{ define "main" }}

  <main class="ml-sm-auto col-md-9 col-lg-10 px-4 pt-0 pt-md-11">

    <div class="row pt-3">

        <div class="col-xl-12 order-xl-1 duik-content">

          <h1>Feedback on specific docs pages</h1>

          <table id="feedbackTable" x-data="feedbackData()" x-init="fetchFeedback()">
            <thead>
              <tr>
                <th>
                  Date
                  {{ partial "feedback/sort-buttons" (dict "column" "date" ) }}
                </th>
                <th>
                  URL
                  {{ partial "feedback/sort-buttons" (dict "column" "url" ) }}
                </th>
                <th>
                  Positive votes
                  {{ partial "feedback/sort-buttons" (dict "column" "positiveFeedback" ) }}
                </th>
                <th>
                  Negative votes
                  {{ partial "feedback/sort-buttons" (dict "column" "negativeFeedback" ) }}
                </th>
              </tr>
            </thhead>
            <tbody>
              <template x-for="feedbackItem in feedbackItems">
                <tr>
                  <td x-text="new Date(feedbackItem.date).toDateString()"></td>   
                  <td x-text="feedbackItem.url"></td>   
                  <td x-text="feedbackItem.positiveFeedback"></td>   
                  <td x-text="feedbackItem.negativeFeedback"></td>   
                </tr>
              </template>
            </tbody>
          </table>

          <script>
            function feedbackData() {
              return {
                feedbackItems: null,
                sortColumn: null,
                fetchFeedback() {
                  this.isLoading = true;
                  fetch("/feedback/data")
                    .then(res => res.json())
                    .then(data => {
                      this.feedbackItems = data;
                    })
                },
                sort(column, sortAsc) {
                  this.sortColumn = column;
                  this.feedbackItems.sort((a, b) => {
                    if(a[this.sortColumn] < b[this.sortColumn]) return sortAsc ? 1 : -1;
                    if(a[this.sortColumn] > b[this.sortColumn]) return sortAsc ? -1 : 1;
                    return 0;
                  });
                }
              }
            }
          </script>
        
        </div>

    </div>

    <!-- Footer -->
    {{ partial "footer/footer" . }}

  </main>

{{ end }}
